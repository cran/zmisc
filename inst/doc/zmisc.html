<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>zmisc</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">zmisc</h1>



<div id="vector-look-ups-and-safer-sampling" class="section level2">
<h2>Vector Look-Ups and Safer Sampling</h2>
<p>A collection of utility functions that facilitate looking up vector
values from a lookup table, annotate values in at table for clearer
viewing, and support a safer approach to vector sampling, sequence
generation, and aggregation.</p>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>You can install the released version of <code>zmisc</code> from <a href="https://cran.r-project.org/package=zmisc">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;zmisc&quot;</span>)</span></code></pre></div>
<p>You can use <code>pak</code> to install the development version of
<code>zmisc</code> from <a href="https://github.com/torfason/zmisc">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>pak<span class="sc">::</span><span class="fu">pak</span>(<span class="st">&quot;torfason/zmisc&quot;</span>)</span></code></pre></div>
</div>
<div id="usage" class="section level2">
<h2>Usage</h2>
<p>In order to use the package, you generally want to attach it
first:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(zmisc)</span></code></pre></div>
</div>
<div id="quick-and-easy-value-lookups" class="section level2">
<h2>Quick and easy value lookups</h2>
<p>The functions <a href="https://torfason.github.io/zmisc/reference/lookup.html">lookup()</a>
and <a href="https://torfason.github.io/zmisc/reference/lookuper.html">lookuper()</a>
are used to look up values from a lookup table, which can be supplied as
a <code>vector</code>, a <code>list</code>, or a
<code>data.frame</code>. The functions are in some ways similar to the
Excel function <code>VLOOKUP()</code>, but are designed to work smoothly
in an R workflow, in particular within pipes.</p>
<div id="lookup-lookup-values-from-a-lookup-table" class="section level3">
<h3>lookup: Lookup values from a lookup table</h3>
<p>The <a href="https://torfason.github.io/zmisc/reference/lookup.html">lookup()</a>
function implements lookup of certain strings (such as variable names)
from a lookup table which maps keys onto values (such as variable labels
or descriptions).</p>
<p>The lookup table can be in the form of a two-column
<code>data.frame</code>, in the form of a named <code>vector</code>, or
in the form of a <code>list</code>. If the table is in the form of a
<code>data.frame</code>, the lookup columns should be named
<code>name</code> (for the key) and <code>value</code> (for the value).
If the lookup table is in the form of a named <code>vector</code> or
<code>list</code>, the name is used for the key, and the returned value
is taken from the values in the vector or list.</p>
<p>Original values are returned if they are not found in the lookup
table. Alternatively, a <code>default</code> can be specified for values
that are not found. Note that an <code>NA</code> in x will never be
found and will be replaced with the default value. To specify different
defaults for values that are not found and for <code>NA</code> values in
<code>x</code>, the <code>default</code> must be crafted manually to
achieve this.</p>
<p>Any names in x are not included in the result.</p>
<div id="examples" class="section level4">
<h4>Examples</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>fruit_lookup_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">a=</span><span class="st">&quot;Apple&quot;</span>, <span class="at">b=</span><span class="st">&quot;Banana&quot;</span>, <span class="at">c=</span><span class="st">&quot;Cherry&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">lookup</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], fruit_lookup_vector)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">lookup</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], fruit_lookup_vector, <span class="at">default =</span> <span class="cn">NA</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>mtcars_lookup_data_frame <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;mpg&quot;</span>, <span class="st">&quot;hp&quot;</span>, <span class="st">&quot;wt&quot;</span>),</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="st">&quot;Miles/(US) gallon&quot;</span>, <span class="st">&quot;Gross horsepower&quot;</span>, <span class="st">&quot;Weight (1000 lbs)&quot;</span>))</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="fu">lookup</span>(<span class="fu">names</span>(mtcars), mtcars_lookup_data_frame)</span></code></pre></div>
</div>
</div>
<div id="lookuper-construct-lookup-function-based-on-a-specific-lookup-table" class="section level3">
<h3>lookuper: Construct lookup function based on a specific lookup
table</h3>
<p>The <a href="https://torfason.github.io/zmisc/reference/lookuper.html">lookuper()</a>
function returns <em>a function</em> equivalent to the <a href="https://torfason.github.io/zmisc/reference/lookup.html">lookup()</a>
function, except that instead of taking a lookup table as an argument,
the lookup table is embedded in the function itself.</p>
<p>This can be very useful, in particular when using the lookup function
as an argument to other functions that expect a function which maps
<code>character</code>-&gt;<code>character</code> but do not offer a
good way to pass additional arguments to that function.</p>
<div id="examples-1" class="section level4">
<h4>Examples</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>lookup_fruits <span class="ot">&lt;-</span> <span class="fu">lookuper</span>(<span class="fu">list</span>(<span class="at">a=</span><span class="st">&quot;Apple&quot;</span>, <span class="at">b=</span><span class="st">&quot;Banana&quot;</span>, <span class="at">c=</span><span class="st">&quot;Cherry&quot;</span>))</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">lookup_fruits</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code></pre></div>
</div>
</div>
</div>
<div id="safer-sampling-sequencing-and-aggregation" class="section level2">
<h2>Safer sampling, sequencing and aggregation</h2>
<p>The functions <a href="https://torfason.github.io/zmisc/reference/zample.html">zample()</a>,
<a href="https://torfason.github.io/zmisc/reference/zeq.html">zeq()</a>,
and <a href="https://torfason.github.io/zmisc/reference/zingle.html">zingle()</a>
are intended to make your code less likely to break in mysterious ways
when you encounter unexpected boundary conditions. The <a href="https://torfason.github.io/zmisc/reference/zample.html">zample()</a>
and <a href="https://torfason.github.io/zmisc/reference/zeq.html">zeq()</a> are
almost identical to the <a href="https://rdrr.io/r/base/sample.html">sample()</a> and <a href="https://rdrr.io/r/base/seq.html">seq()</a> functions, but a bit
safer.</p>
<div id="zample-sample-from-a-vector-in-a-safe-way" class="section level3">
<h3>zample: Sample from a vector in a safe way</h3>
<p>The <a href="https://torfason.github.io/zmisc/reference/zample.html">zample()</a>
function duplicates the functionality of <a href="https://rdrr.io/r/base/sample.html">sample()</a>, with the
exception that it does not attempt the (sometimes dangerous)
user-friendliness of switching the interpretation of the first element
to a number if the length of the vector is 1. <code>zample()</code>
<em>always</em> treats its first argument as a vector containing
elements that should be sampled, so your code wonâ€™t break in unexpected
ways when the input vector happens to be of length 1.</p>
<div id="examples-2" class="section level4">
<h4>Examples</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># For vectors of length 2 or more, zample() and sample() are identical</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">zample</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">sample</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co"># For vectors of length 1, zample() will still sample from the vector,</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co"># whereas sample() will &quot;magically&quot; switch to interpreting the input</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co"># as a number n, and sampling from the vector 1:n.</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">zample</span>(<span class="dv">7</span>)</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">sample</span>(<span class="dv">7</span>)</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co"># The other arguments work in the same way as for sample()</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">zample</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>, <span class="at">size=</span><span class="dv">13</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob=</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">1</span>)<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">sample</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>, <span class="at">size=</span><span class="dv">13</span>, <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob=</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">1</span>)<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co"># Of course, sampling more than the available elements without</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co"># setting replace=TRUE will result in an error</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">tryCatch</span>(<span class="fu">zample</span>(<span class="dv">7</span>, <span class="at">size=</span><span class="dv">2</span>), <span class="at">error=</span>wrap_error)</span></code></pre></div>
</div>
</div>
<div id="zeq-generate-sequence-in-a-safe-way" class="section level3">
<h3>zeq: Generate sequence in a safe way</h3>
<p>The <a href="https://torfason.github.io/zmisc/reference/zeq.html">zeq()</a>
function creates an increasing integer sequence, but differs from the
standard one in that it will not silently generate a decreasing sequence
when the second argument is smaller than the first. If the second
argument is one smaller than the first it will generate an empty
sequence, if the difference is greater, the function will throw an
error.</p>
<div id="examples-3" class="section level4">
<h4>Examples</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># For increasing sequences, zeq() and seq() are identical</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">zeq</span>(<span class="dv">11</span>,<span class="dv">15</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">zeq</span>(<span class="dv">11</span>,<span class="dv">11</span>)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co"># If second argument equals first-1, an empty sequence is returned</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="fu">zeq</span>(<span class="dv">11</span>,<span class="dv">10</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co"># If second argument is less than first-1, the function throws an error</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="fu">zeq</span>(<span class="dv">11</span>,<span class="dv">9</span>), <span class="at">error=</span>wrap_error)</span></code></pre></div>
</div>
</div>
<div id="zingle-return-the-single-unique-value-found-in-a-vector" class="section level3">
<h3>zingle: Return the single (unique) value found in a vector</h3>
<p>The <a href="https://torfason.github.io/zmisc/reference/zingle.html">zingle()</a>
function returns the first element in a vector, but only if all the
other elements are identical to the first one (the vector only has a
<code>zingle</code> value). If the elements are not all identical, it
throws an error. The vector must contain at least one
non-<code>NA</code> value, or the function errors out as well. This is
especially useful in aggregations, when all values in a given group
should be identical, but you want to make sure.</p>
<div id="examples-4" class="section level4">
<h4>Examples</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># If all elements are identical, all is good.</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co"># The value of the element is returned.</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">zingle</span>(<span class="fu">c</span>(<span class="st">&quot;Alpha&quot;</span>, <span class="st">&quot;Alpha&quot;</span>, <span class="st">&quot;Alpha&quot;</span>))</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co"># If any elements differ, an error is thrown</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="fu">tryCatch</span>(<span class="fu">zingle</span>(<span class="fu">c</span>(<span class="st">&quot;Alpha&quot;</span>, <span class="st">&quot;Beta&quot;</span>, <span class="st">&quot;Alpha&quot;</span>)), <span class="at">error=</span>wrap_error)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>, <span class="at">warn.conflicts=</span><span class="cn">FALSE</span>)) {</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  d <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    <span class="sc">~</span>id, <span class="sc">~</span>name, <span class="sc">~</span>fouls,</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    <span class="dv">1</span>, <span class="st">&quot;James&quot;</span>, <span class="dv">3</span>,</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>    <span class="dv">2</span>, <span class="st">&quot;Jack&quot;</span>,  <span class="dv">2</span>,</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>    <span class="dv">1</span>, <span class="st">&quot;James&quot;</span>, <span class="dv">4</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>  )</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>  <span class="co"># If the data is of the correct format, all is good</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">name=</span><span class="fu">zingle</span>(name), <span class="at">total_fouls=</span><span class="fu">sum</span>(fouls))</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a> }</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>, <span class="at">warn.conflicts=</span><span class="cn">FALSE</span>)) {</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>  <span class="co"># If a name does not match its ID, we should get an error</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>  d[<span class="dv">1</span>,<span class="st">&quot;name&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Jammes&quot;</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>    d <span class="sc">%&gt;%</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">name=</span><span class="fu">zingle</span>(name), <span class="at">total_fouls=</span><span class="fu">sum</span>(fouls))</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>  }, <span class="at">error=</span>wrap_error)</span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
</div>
<div id="getting-a-better-view-on-variables" class="section level2">
<h2>Getting a better view on variables</h2>
<p>The <a href="https://torfason.github.io/zmisc/reference/zingle.html">notate()</a>
function adds annotations to <code>factor</code> and
<code>labelled</code> variables that make it easier to see both values
and labels/levels when using the <a href="https://rdrr.io/r/utils/View.html">View()</a> function</p>
<div id="notate-embed-factor-levels-and-value-labels-in-values." class="section level3">
<h3>notate: Embed factor levels and value labels in values.</h3>
<p>This function adds level/label information as an annotation to either
factors or <code>labelled</code> variables. This function is called
<code>notate()</code> rather than <code>annotate()</code> to avoid
conflict with <code>ggplot2::annotate()</code>. It is a generic that can
operate either on individual vectors or on a
<code>data.frame</code>.</p>
<p>When printing <code>labelled</code> variables from a
<code>tibble</code> in a console, both the numeric value and the text
label are shown, but no variable labels. When using the
<code>View()</code> function, only variable labels are shown but no
value labels. For factors, there is no way to view the integer levels
and values at the same time.</p>
<p>In order to allow the viewing of both variable and value labels at
the same time, this function converts both <code>factor</code> and
<code>labelled</code> variables to <code>character</code>, including
both numeric levels (<code>labelled</code> values) and character values
(<code>labelled</code> labels) in the output.</p>
<div id="examples-5" class="section level4">
<h4>Examples</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="at">chr =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="at">fct =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;bravo&quot;</span>, <span class="st">&quot;chrly&quot;</span>, <span class="st">&quot;delta&quot;</span>)),</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="at">lbl =</span> <span class="fu">ll_labelled</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="cn">NA</span>),</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="at">one=</span><span class="dv">1</span>, <span class="at">two=</span><span class="dv">2</span>),</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>                    <span class="at">label =</span> <span class="st">&quot;A labelled vector&quot;</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>dn <span class="ot">&lt;-</span> <span class="fu">notate</span>(d)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>dn</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co"># View(dn)</span></span></code></pre></div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
